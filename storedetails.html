<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wohle Sale Terranova Vintage - Store Details</title>
  <meta name="color-scheme" content="dark light">
  <meta name="robots" content="noindex">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#93a2b7; --accent:#3b82f6; --good:#22c55e; --bad:#ef4444; --gap-s:8px; --gap-m:12px; --gap-l:16px; --pad-card:16px }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    h1{margin:0 0 16px;font-size:28px}

    .card{background:var(--card);border:1px solid #1e293b;border-radius:14px;padding:var(--pad-card);box-shadow:0 1px 0 rgba(255,255,255,.04) inset, 0 8px 24px rgba(0,0,0,.25)}
    .row-between{display:flex;justify-content:space-between;align-items:center;gap:var(--gap-m)}
    .row{display:flex;align-items:center;gap:var(--gap-m)}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--good);box-shadow:0 0 8px rgba(34,197,94,.85)}
    .kpi{font-size:13px;color:var(--muted);margin-bottom:6px}
    .foot{margin-top:16px;color:var(--muted);font-size:12px}
    .store-link{ color:var(--text); text-decoration:none }
    .store-link:hover{ color:var(--accent); text-decoration:underline }

    /* Table styling matching the dashboard theme */
    .data-table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #1e293b;border-radius:12px;overflow:hidden;background:#0b1220}
    .data-table thead th{background:#0e1524;color:#cbd5e1;text-align:left;font-weight:600;font-size:13px;padding:10px 12px;border-bottom:1px solid #1e293b}
    .data-table tbody td{padding:10px 12px;font-size:13px;color:#e5e7eb;border-bottom:1px solid #1e293b}
    .data-table tbody tr:nth-child(even){background:#0c1423}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#162235;color:#cbd5e1;border:1px solid #223045}
    .btn{display:inline-block;font-size:13px;padding:8px 12px;border-radius:10px;border:1px solid #223045;background:#0e1524;color:#cbd5e1;text-decoration:none}
    .btn:hover{background:#132036;color:#e5e7eb}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row-between" style="margin-bottom:12px">
      <h1 id="pageTitle">Store Details</h1>
      <a href="index.html" class="btn">Back to Dashboard</a>
    </div>

    <div class="card">
      <div class="row-between" style="margin-bottom:8px">
        <div class="row">
          <span class="dot" title="Online"></span>
          <strong id="storeName" style="font-size:18px">Store</strong>
        </div>
        <span class="badge" id="storeBadge">In-Store Stock</span>
      </div>

      <div class="kpi">Stock Database</div>
      <div style="overflow:auto">
        <table class="data-table" role="grid" aria-label="Store stock table">
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Product</th>
              <th scope="col">Quantity</th>
            </tr>
          </thead>
          <tbody id="stockRows"></tbody>
        </table>
      </div>

      <div class="foot" id="updated"></div>
    </div>
  </div>

  <script>
    (function () {
      function qs(key){ var p=new URLSearchParams(window.location.search); return p.get(key)||''; }
      var store = qs('store') || 'Store';

      document.getElementById('storeName').textContent = store;
      document.getElementById('pageTitle').textContent = 'Store Details – ' + store;

      var host   = document.getElementById('stockRows');
      var badge  = document.getElementById('storeBadge');
      var footer = document.getElementById('updated');

      function cell(tag, text){
        var td = document.createElement(tag);
        td.textContent = (text ?? '');
        return td;
      }

      function render(rows){
        host.innerHTML = '';
        (rows || []).forEach(function(r){
          var tr = document.createElement('tr');
          tr.appendChild(cell('td', r.id));
          tr.appendChild(cell('td', r.product));     // <-- product field
          tr.appendChild(cell('td', r.quantity));    // <-- quantity field
          host.appendChild(tr);
        });
        badge.textContent = (rows?.length || 0) + ' records';
        var now = new Date();
        footer.textContent = 'Last updated: ' + (now.toLocaleString ? now.toLocaleString('en-US') : now);
      }

      // Loading state
      host.innerHTML = '<tr><td colspan="3">Loading…</td></tr>';
      badge.textContent = '…';

      // Use the Netlify proxy you set in netlify.toml
      var ENDPOINT = '/api/get-stock';

      fetch(ENDPOINT + '?store=' + encodeURIComponent(store), {
        method: 'GET'
        // If you inject a secret header via netlify.toml, no need to add it here.
      })
      .then(function(res){
        if(!res.ok) throw new Error('Request failed: ' + res.status);
        return res.json();
      })
      .then(function(data){
        if(!Array.isArray(data)) throw new Error('Unexpected response shape');
        render(data);
      })
      .catch(function(err){
        console.error(err);
        host.innerHTML = '<tr><td colspan="3">Could not load data.</td></tr>';
        badge.textContent = '0 records';
        var now = new Date();
        footer.textContent = 'Last updated: ' + (now.toLocaleString ? now.toLocaleString('en-US') : now);
      });
    })();
  </script>
</body>
</html>
