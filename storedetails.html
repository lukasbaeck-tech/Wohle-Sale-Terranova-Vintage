<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vintage Wholesale EU - Store Details</title>
  <meta name="color-scheme" content="dark light">
  <meta name="robots" content="noindex">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#93a2b7; --accent:#3b82f6; --good:#22c55e; --bad:#ef4444; --gap-s:8px; --gap-m:12px; --gap-l:16px; --pad-card:16px }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    h1{margin:0 0 16px;font-size:28px}

    .card{background:var(--card);border:1px solid #1e293b;border-radius:14px;padding:var(--pad-card);box-shadow:0 1px 0 rgba(255,255,255,.04) inset, 0 8px 24px rgba(0,0,0,.25)}
    .row-between{display:flex;justify-content:space-between;align-items:center;gap:var(--gap-m)}
    .row{display:flex;align-items:center;gap:var(--gap-m)}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--good);box-shadow:0 0 8px rgba(34,197,94,.85)}
    .kpi{font-size:13px;color:var(--muted);margin-bottom:6px}
    .foot{margin-top:16px;color:var(--muted);font-size:12px}
    .store-link{ color:var(--text); text-decoration:none }
    .store-link:hover{ color:var(--accent); text-decoration:underline }

    /* Table styling matching the dashboard theme */
    .data-table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #1e293b;border-radius:12px;overflow:hidden;background:#0b1220}
    .data-table thead th{background:#0e1524;color:#cbd5e1;text-align:left;font-weight:600;font-size:13px;padding:10px 12px;border-bottom:1px solid #1e293b}
    .data-table tbody td{padding:10px 12px;font-size:13px;color:#e5e7eb;border-bottom:1px solid #1e293b}
    .data-table tbody tr:nth-child(even){background:#0c1423}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#162235;color:#cbd5e1;border:1px solid #223045}
    .btn{display:inline-block;font-size:13px;padding:8px 12px;border-radius:10px;border:1px solid #223045;background:#0e1524;color:#cbd5e1;text-decoration:none}
    .btn:hover{background:#132036;color:#e5e7eb}

    /* Emphasize and center the inventory button */
    .button-row{ display:flex; justify-content:center; margin-top:14px }
    #addBtn{ font-size:14px; font-weight:600; padding:10px 14px; border-color:#355d8e; color:#e7edf5; background:#132036; box-shadow:0 2px 10px rgba(0,0,0,.22), 0 0 0 1px rgba(59,130,246,.22) inset }
    #addBtn:hover{ background:#16324a; color:#ffffff; box-shadow:0 3px 12px rgba(0,0,0,.26), 0 0 0 1px rgba(59,130,246,.28) inset }
    #addBtn:disabled{ opacity:.7; cursor:not-allowed }

    /* Simple modal dialog */
    .modal{ position:fixed; inset:0; display:none; z-index:1000 }
    .modal.open{ display:block }
    .modal-overlay{ position:absolute; inset:0; background:rgba(2,8,23,.65); backdrop-filter:blur(2px) }
    .modal-content{ position:absolute; left:50%; top:50%; transform:translate(-50%, -50%); width:min(480px, 92vw) }
    .modal-content.card{ padding:20px }
    .modal-title{ font-weight:700; font-size:16px; color:#e7edf5 }

    /* Progress styling */
    progress{ width:100%; height:12px; background:#0b1220; border:1px solid #1e293b; border-radius:999px; overflow:hidden }
    progress::-webkit-progress-bar{ background:#0b1220; border-radius:999px }
    progress::-webkit-progress-value{ background:linear-gradient(90deg,#2f4858,#6b8aa8); border-radius:999px }
    progress::-moz-progress-bar{ background:linear-gradient(90deg,#2f4858,#6b8aa8) }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row-between" style="margin-bottom:12px">
      <h1 id="pageTitle">Store Details</h1>
      <a href="index.html" class="btn">Back to Dashboard</a>
    </div>

    <div class="card">
      <div class="row-between" style="margin-bottom:8px">
        <div class="row">
          <span class="dot" title="Online"></span>
          <strong id="storeName" style="font-size:18px">Store</strong>
        </div>
        <span class="badge" id="storeBadge">In-Store Stock</span>
      </div>

      <div class="kpi">Stock Database</div>
      <div style="overflow:auto">
        <table class="data-table" role="grid" aria-label="Store stock table">
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Product</th>
              <th scope="col">Quantity</th>
            </tr>
          </thead>
          <tbody id="stockRows"></tbody>
        </table>
      </div>

      <div class="button-row">
        <button type="button" class="btn" id="addBtn">Add to Store Inventory</button>
      </div>

      <div class="kpi" id="actionMsg" style="margin-top:10px; display:none"></div>

      <!-- Modal dialog for progress -->
      <div class="modal" id="inventoryModal" aria-hidden="true">
        <div class="modal-overlay"></div>
        <div class="modal-content card">
          <div class="row-between" style="margin-bottom:10px">
            <div class="modal-title">Adding Inventory</div>
            <button type="button" class="btn" id="modalClose" style="padding:4px 8px;font-size:12px">Close</button>
          </div>
          <progress id="modalProgress" max="100" value="0" aria-label="Progress"></progress>
          <div class="kpi" id="modalText" style="margin-top:8px">Processing…</div>
        </div>
      </div>

      <div class="foot" id="updated"></div>
    </div>
  </div>

  <script>
    (function () {
      function qs(key){ var p=new URLSearchParams(window.location.search); return p.get(key)||''; }
      var store = qs('store') || 'Store';

      document.getElementById('storeName').textContent = store;
      document.getElementById('pageTitle').textContent = 'Store Details – ' + store;

      var host   = document.getElementById('stockRows');
      var badge  = document.getElementById('storeBadge');
      var footer = document.getElementById('updated');
      var addBtn = document.getElementById('addBtn');
      var actionMsg = document.getElementById('actionMsg');
      var modal = document.getElementById('inventoryModal');
      var modalClose = document.getElementById('modalClose');
      var modalOverlay = document.querySelector('#inventoryModal .modal-overlay');
      var modalProgress = document.getElementById('modalProgress');
      var modalText = document.getElementById('modalText');

      function cell(tag, text){
        var td = document.createElement(tag);
        td.textContent = (text ?? '');
        return td;
      }

      function render(rows){
        host.innerHTML = '';
        (rows || []).forEach(function(r){
          var tr = document.createElement('tr');
          tr.appendChild(cell('td', r.id));
          tr.appendChild(cell('td', r.product));     // <-- product field
          tr.appendChild(cell('td', r.quantity));    // <-- quantity field
          host.appendChild(tr);
        });
        badge.textContent = (rows?.length || 0) + ' records';
        var now = new Date();
        footer.textContent = 'Last updated: ' + (now.toLocaleString ? now.toLocaleString('en-US') : now);
      }

      // Loading state
      host.innerHTML = '<tr><td colspan="3">Loading…</td></tr>';
      badge.textContent = '…';

      // Use the Netlify proxy you set in netlify.toml
      var ENDPOINT = '/api/get-stock';

      fetch(ENDPOINT + '?store=' + encodeURIComponent(store), {
        method: 'GET'
        // If you inject a secret header via netlify.toml, no need to add it here.
      })
      .then(function(res){
        if(!res.ok) throw new Error('Request failed: ' + res.status);
        return res.json();
      })
      .then(function(data){
        if(!Array.isArray(data)) throw new Error('Unexpected response shape');
        render(data);
      })
      .catch(function(err){
        console.error(err);
        host.innerHTML = '<tr><td colspan="3">Could not load data.</td></tr>';
        badge.textContent = '0 records';
        var now = new Date();
        footer.textContent = 'Last updated: ' + (now.toLocaleString ? now.toLocaleString('en-US') : now);
      });

      function openModal(){ if(modal){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); } }
      function closeModal(){ if(modal){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); } }

      if(modalClose){ modalClose.addEventListener('click', closeModal); }
      if(modalOverlay){ modalOverlay.addEventListener('click', closeModal); }

      // Add to inventory action: clear table, show modal with 0.2s progress, then show message
      if(addBtn){
        addBtn.addEventListener('click', function(){
          // Clear table data immediately
          host.innerHTML = '';
          badge.textContent = '0 records';
          actionMsg.textContent = '';
          actionMsg.style.display = 'none';

          // Show dialog and simulate quick progress (0.2s)
          openModal();
          addBtn.disabled = true;
          if(modalProgress){ modalProgress.value = 0; }
          if(modalText){ modalText.textContent = 'Processing…'; }

          var start = Date.now();
          var duration = 500; // 0.5s
          var timer = setInterval(function(){
            var elapsed = Date.now() - start;
            var pct = Math.min(100, Math.round((elapsed / duration) * 100));
            if(modalProgress){ modalProgress.value = pct; }
            if(elapsed >= duration){
              clearInterval(timer);
              if(modalProgress){ modalProgress.value = 100; }
              if(modalText){ modalText.textContent = 'all inventory added'; }
              actionMsg.textContent = 'all inventory added';
              actionMsg.style.display = 'block';
              addBtn.disabled = false;
              // Auto-close the dialog when finished
              closeModal();
            }
          }, 25);
        });
      }
    })();
  </script>
</body>
</html>
